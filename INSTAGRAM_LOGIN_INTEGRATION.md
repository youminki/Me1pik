# ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ì™„ì „ ì—°ë™ ë¡œê·¸ì¸ ê²½í—˜ êµ¬í˜„

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ì¸ìŠ¤íƒ€ê·¸ë¨ê³¼ ê°™ì€ ì™„ì „ ì—°ë™ëœ ë¡œê·¸ì¸ ê²½í—˜ì„ ì œê³µí•˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ(iOS ì›¹ë·°) ì•±ì„ ìœ„í•œ ì›¹ êµ¬í˜„ì…ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ëª©í‘œ

- **ì•±ì—ì„œ ë¡œê·¸ì¸** â†’ ì›¹ë·° ìë™ ë¡œê·¸ì¸
- **ì›¹ë·°ì—ì„œ ë¡œê·¸ì¸** â†’ ì•± ìë™ ë¡œê·¸ì¸
- **í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹ ** â†’ ì•±/ì›¹ë·° ë™ì‹œ ê°±ì‹ 
- **ë¡œê·¸ì•„ì›ƒ ì‹œ ë™ê¸°í™”** â†’ ì•±/ì›¹ë·° ë™ì‹œ ë¡œê·¸ì•„ì›ƒ
- **ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€** â†’ ë¸Œë¼ìš°ì € ë‹«ì•„ë„ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### 1. í† í° ê´€ë¦¬ ì‹œìŠ¤í…œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   iOS ì•±        â”‚    â”‚   ì›¹ë·°          â”‚    â”‚   ì„œë²„          â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Keychain      â”‚â—„â”€â”€â–ºâ”‚ â€¢ localStorage  â”‚â—„â”€â”€â–ºâ”‚ â€¢ JWT í† í°      â”‚
â”‚ â€¢ UserDefaults  â”‚    â”‚ â€¢ sessionStorageâ”‚    â”‚ â€¢ Refresh í† í°  â”‚
â”‚ â€¢ ë©”ëª¨ë¦¬        â”‚    â”‚ â€¢ Cookies       â”‚    â”‚ â€¢ ë§Œë£Œ ê´€ë¦¬      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ì‹œìŠ¤í…œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë¡œê·¸ì¸ ìƒíƒœ   â”‚    â”‚   ì„¸ì…˜ ìœ ì§€     â”‚
â”‚   ìœ ì§€          â”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ localStorage  â”‚    â”‚ â€¢ sessionStorageâ”‚
â”‚ â€¢ ì˜êµ¬ ë³´ê´€     â”‚    â”‚ â€¢ ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´â”‚
â”‚ â€¢ ì„¤ì • ì €ì¥     â”‚    â”‚   ì‚­ì œ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. í†µì‹  í”Œë¡œìš°

#### ì•± â†’ ì›¹ë·° í†µì‹ 

```swift
// Swiftì—ì„œ ì›¹ë·°ë¡œ í† í° ì „ë‹¬
let js = """
window.dispatchEvent(new CustomEvent('loginInfoReceived', {
  detail: {
    isLoggedIn: true,
    userInfo: {
      token: '\(accessToken)',
      refreshToken: '\(refreshToken)',
      email: '\(email)'
    }
  }
}));
"""
webView.evaluateJavaScript(js, completionHandler: nil)
```

#### ì›¹ë·° â†’ ì•± í†µì‹ 

```javascript
// ì›¹ì—ì„œ ì•±ìœ¼ë¡œ ë¡œê·¸ì¸ ì •ë³´ ì „ë‹¬
window.webkit.messageHandlers.loginHandler.postMessage({
  type: 'login',
  token: accessToken,
  refreshToken: refreshToken,
  email: userEmail,
});
```

---

## ğŸ”§ êµ¬í˜„ëœ ê¸°ëŠ¥

### 1. í† í° ê´€ë¦¬ (`src/utils/auth.ts`)

#### âœ… ë‹¤ì¤‘ ì €ì¥ì†Œ ì§€ì›

- **localStorage**: ì˜êµ¬ ì €ì¥
- **sessionStorage**: ì„¸ì…˜ ì €ì¥
- **Cookies**: ì›¹ë·° í˜¸í™˜ì„±
- **Keychain**: iOS ì•± (Swiftì—ì„œ êµ¬í˜„)

#### âœ… ìë™ í† í° ê°±ì‹ 

```typescript
// í† í° ë§Œë£Œ 5ë¶„ ì „ ìë™ ê°±ì‹ 
const setupTokenRefreshTimer = (token: string): void => {
  const payload = JSON.parse(atob(token.split('.')[1]));
  const refreshTime = (payload.exp - currentTime - 300) * 1000;

  tokenRefreshTimer = setTimeout(async () => {
    await refreshToken();
  }, refreshTime);
};
```

#### âœ… ì•±-ì›¹ë·° ë™ê¸°í™”

```typescript
// ì•±ì— ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ì „ë‹¬
const notifyAppLogin = (accessToken: string, refreshToken?: string): void => {
  if (window.webkit?.messageHandlers?.loginHandler) {
    window.webkit.messageHandlers.loginHandler.postMessage({
      type: 'login',
      token: accessToken,
      refreshToken: refreshToken,
    });
  }
};
```

#### âœ… ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€

```typescript
// ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í† í° ì €ì¥
export const saveTokensWithKeepLogin = (
  accessToken: string,
  refreshToken?: string,
  keepLogin: boolean = false
): void => {
  // ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ì„¤ì • ì €ì¥
  saveKeepLoginSetting(keepLogin);

  if (keepLogin) {
    // localStorageì— ì €ì¥ (ì˜êµ¬ ë³´ê´€)
    localStorage.setItem('accessToken', accessToken);
  } else {
    // sessionStorageì— ì €ì¥ (ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ì‚­ì œ)
    sessionStorage.setItem('accessToken', accessToken);
  }
};
```

### 2. ì›¹ë·° í†µì‹  ìŠ¤í¬ë¦½íŠ¸ (`public/webview_integration.js`)

#### âœ… ë„¤ì´í‹°ë¸Œ ì•± ê°ì§€

```javascript
function detectNativeApp() {
  isNativeApp = !!(
    window.webkit?.messageHandlers ||
    window.nativeApp ||
    window.ReactNativeWebView
  );
}
```

#### âœ… ì–‘ë°©í–¥ í†µì‹ 

```javascript
// ì•±ì— ë¡œê·¸ì¸ ì •ë³´ ì „ë‹¬
function notifyAppLogin(loginInfo) {
  loginHandler.postMessage({
    type: 'login',
    token: loginInfo.token,
    refreshToken: loginInfo.refreshToken,
    email: loginInfo.email,
  });
}

// ì•±ì—ì„œ ë°›ì€ ë¡œê·¸ì¸ ì •ë³´ ì²˜ë¦¬
function handleAppLogin(loginInfo) {
  // ë‹¤ì¤‘ ì €ì¥ì†Œì— í† í° ì €ì¥
  localStorage.setItem('accessToken', loginInfo.token);
  sessionStorage.setItem('accessToken', loginInfo.token);
  // ...
}
```

#### âœ… ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€

```javascript
// ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í™•ì¸
function checkInstagramLoginStatus() {
  const localToken = localStorage.getItem('accessToken');
  const sessionToken = sessionStorage.getItem('accessToken');
  const token = localToken || sessionToken;

  if (!token) return false;

  // í† í° ìœ íš¨ì„± ê²€ì‚¬
  const payload = JSON.parse(atob(token.split('.')[1]));
  return payload.exp && payload.exp > Date.now() / 1000;
}
```

### 3. ë¡œê·¸ì¸ í˜ì´ì§€ (`src/pages/Login.tsx`)

#### âœ… ì›¹ë·° í†µì‹  ì—°ë™

```typescript
// ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì•±ì— ì •ë³´ ì „ë‹¬
if ((window as any).handleWebLoginSuccess) {
  (window as any).handleWebLoginSuccess({
    token: accessToken,
    refreshToken: refreshToken,
    email: data.email,
    userId: data.email,
    name: '',
    keepLogin: keepLogin, // ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ì„¤ì •
  });
}
```

#### âœ… ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ UI

```typescript
// ì´ì „ ì„¤ì • ë³µì›
const [keepLogin, setKeepLogin] = useState(() => getKeepLoginSetting());

// ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í† í° ì €ì¥
saveTokensWithKeepLogin(accessToken, refreshToken, keepLogin);
```

### 4. ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (`src/components/MypageModal.tsx`)

#### âœ… ë™ê¸°í™”ëœ ë¡œê·¸ì•„ì›ƒ

```typescript
// ë¡œê·¸ì•„ì›ƒ ì‹œ ì•±ì— ì•Œë¦¼
if ((window as any).handleWebLogout) {
  (window as any).handleWebLogout();
}
await logout();
```

---

## ğŸš€ ì‚¬ìš©ë²•

### 1. ì•±ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ

```swift
// Swiftì—ì„œ ì›¹ë·°ì— í† í° ì „ë‹¬
let js = """
window.dispatchEvent(new CustomEvent('loginInfoReceived', {
  detail: {
    isLoggedIn: true,
    userInfo: {
      token: '\(accessToken)',
      refreshToken: '\(refreshToken)',
      email: '\(email)'
    }
  }
}));
"""
webView.evaluateJavaScript(js, completionHandler: nil)
```

### 2. ì›¹ë·°ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ

```javascript
// ì›¹ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ìë™ìœ¼ë¡œ ì•±ì— ì „ë‹¬
handleWebLoginSuccess({
  token: 'access_token',
  refreshToken: 'refresh_token',
  email: 'user@email.com',
  keepLogin: true, // ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
});
```

### 3. ë¡œê·¸ì•„ì›ƒ ì‹œ

```typescript
// ì›¹ì—ì„œ ë¡œê·¸ì•„ì›ƒ
handleWebLogout();

// ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ
// Swiftì—ì„œ ì›¹ë·°ì— ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬
```

### 4. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í™•ì¸

```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸
window.checkInstagramLoginStatus();

// ì„¤ì • í™•ì¸
window.getKeepLoginSetting();
```

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. í† í° ì €ì¥

- **ì•±**: Keychain ì‚¬ìš© (iOS)
- **ì›¹**: httpOnly cookie ê¶Œì¥, localStorageëŠ” í¸ì˜ì„±
- **HTTPS**: ëª¨ë“  í†µì‹ ì—ì„œ HTTPS ì‚¬ìš©

### 2. í† í° ê°±ì‹ 

- **ìë™ ê°±ì‹ **: ë§Œë£Œ 5ë¶„ ì „ ìë™ ê°±ì‹ 
- **ì‹¤íŒ¨ ì²˜ë¦¬**: ê°±ì‹  ì‹¤íŒ¨ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
- **ë°±ê·¸ë¼ìš´ë“œ**: ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ê°±ì‹  ì²˜ë¦¬

### 3. ë¡œê·¸ì•„ì›ƒ ë™ê¸°í™”

- **ì¦‰ì‹œ ë™ê¸°í™”**: ì•±/ì›¹ë·° ë™ì‹œ ë¡œê·¸ì•„ì›ƒ
- **í† í° ì‚­ì œ**: ëª¨ë“  ì €ì¥ì†Œì—ì„œ í† í° ì™„ì „ ì‚­ì œ

### 4. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ë³´ì•ˆ

- **localStorage**: ì˜êµ¬ ë³´ê´€, ë¸Œë¼ìš°ì € ë‹«ì•„ë„ ìœ ì§€
- **sessionStorage**: ì„¸ì…˜ ìœ ì§€, ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ì‚­ì œ
- **ì„¤ì • ì €ì¥**: ì‚¬ìš©ì ì„ íƒì„ localStorageì— ì €ì¥
- **ê³µìš© PC ê²½ê³ **: ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ì‹œ ë³´ì•ˆ ê²½ê³  í‘œì‹œ

---

## ğŸ“ ì£¼ì˜ì‚¬í•­

1. **HTTPS í•„ìˆ˜**: í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ HTTPS ì‚¬ìš©
2. **í† í° ë³´ì•ˆ**: ë¯¼ê°í•œ ì •ë³´ëŠ” ì•ˆì „í•œ ì €ì¥ì†Œ ì‚¬ìš©
3. **ì—ëŸ¬ ì²˜ë¦¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, í† í° ë§Œë£Œ ë“± ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬
4. **ì„±ëŠ¥**: í† í° ê°±ì‹  ì‹œ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
5. **ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€**: ê³µìš© PCì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì•ˆë‚´
6. **ì„¤ì • ì €ì¥**: ì‚¬ìš©ì ì„ íƒì„ localStorageì— ì €ì¥í•˜ì—¬ ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ ë³µì›

---

## ğŸ”„ ì—…ë°ì´íŠ¸ íˆìŠ¤í† ë¦¬

- **v1.0.0**: ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ì™„ì „ ì—°ë™ ë¡œê·¸ì¸ ê²½í—˜ êµ¬í˜„
- **v1.1.0**: ìë™ í† í° ê°±ì‹  ê¸°ëŠ¥ ì¶”ê°€
- **v1.2.0**: ë‹¤ì¤‘ ì €ì¥ì†Œ ì§€ì› ë° ë³´ì•ˆ ê°•í™”
- **v1.3.0**: ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ê¸°ëŠ¥ ì¶”ê°€

---

## ğŸ“ ì§€ì›

êµ¬í˜„ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ê°œì„  ì œì•ˆì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½í•´ ì£¼ì„¸ìš”!

---

## ğŸ“ ì£¼ì˜ì‚¬í•­

1. **HTTPS í•„ìˆ˜**: í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ HTTPS ì‚¬ìš©
2. **í† í° ë³´ì•ˆ**: ë¯¼ê°í•œ ì •ë³´ëŠ” ì•ˆì „í•œ ì €ì¥ì†Œ ì‚¬ìš©
3. **ì—ëŸ¬ ì²˜ë¦¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, í† í° ë§Œë£Œ ë“± ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬
4. **ì„±ëŠ¥**: í† í° ê°±ì‹  ì‹œ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
5. **ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€**: ê³µìš© PCì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì•ˆë‚´
6. **ì„¤ì • ì €ì¥**: ì‚¬ìš©ì ì„ íƒì„ localStorageì— ì €ì¥í•˜ì—¬ ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ ë³µì›

---

## ğŸ”„ ì—…ë°ì´íŠ¸ íˆìŠ¤í† ë¦¬

- **v1.0.0**: ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ì™„ì „ ì—°ë™ ë¡œê·¸ì¸ ê²½í—˜ êµ¬í˜„
- **v1.1.0**: ìë™ í† í° ê°±ì‹  ê¸°ëŠ¥ ì¶”ê°€
- **v1.2.0**: ë‹¤ì¤‘ ì €ì¥ì†Œ ì§€ì› ë° ë³´ì•ˆ ê°•í™”
- **v1.3.0**: ì¸ìŠ¤íƒ€ê·¸ë¨ ë°©ì‹ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ ê¸°ëŠ¥ ì¶”ê°€

---

## ğŸ“ ì§€ì›

êµ¬í˜„ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ë‚˜ ê°œì„  ì œì•ˆì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½í•´ ì£¼ì„¸ìš”!

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì›¹ë·° í™˜ê²½ í…ŒìŠ¤íŠ¸

```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í…ŒìŠ¤íŠ¸
window.handleWebLoginSuccess({
  token: 'test_token',
  refreshToken: 'test_refresh_token',
  email: 'test@example.com',
  keepLogin: true, // ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í…ŒìŠ¤íŠ¸
});

// ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸
window.handleWebLogout();

// ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬ í…ŒìŠ¤íŠ¸
window.sendLogoutToWebView();

// ì•±ì—ì„œ í† í° ê°±ì‹  ì´ë²¤íŠ¸ ì „ë‹¬ í…ŒìŠ¤íŠ¸
window.sendTokenRefreshToWebView('new_token', 'new_refresh_token');

// ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í…ŒìŠ¤íŠ¸
window.checkInstagramLoginStatus();
```

### 2. ì•± í™˜ê²½ í…ŒìŠ¤íŠ¸

```javascript
// ì•±ì—ì„œ ë°›ì€ ë¡œê·¸ì¸ ì •ë³´ í…ŒìŠ¤íŠ¸
window.handleAppLogin({
  token: 'app_token',
  refreshToken: 'app_refresh_token',
  email: 'app@example.com',
});

// ì•±ì—ì„œ ë°›ì€ ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸
window.handleAppLogout();

// ì•±ì—ì„œ ë°›ì€ í† í° ê°±ì‹  ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸
window.handleAppTokenRefresh({
  token: 'new_app_token',
  refreshToken: 'new_app_refresh_token',
});
```

### 3. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ í…ŒìŠ¤íŠ¸

```javascript
// 1. ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ë¡œ ë¡œê·¸ì¸
window.handleWebLoginSuccess({
  token: 'test_token',
  keepLogin: true,
});

// 2. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ í›„ ìƒíƒœ í™•ì¸
window.checkInstagramLoginStatus(); // true ë°˜í™˜

// 3. ì„¸ì…˜ ìœ ì§€ë¡œ ë¡œê·¸ì¸
window.handleWebLoginSuccess({
  token: 'test_token',
  keepLogin: false,
});

// 4. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ í›„ ìƒíƒœ í™•ì¸
window.checkInstagramLoginStatus(); // false ë°˜í™˜ (sessionStorageëŠ” ìœ ì§€)
```

### 4. ì•±-ì›¹ë·° ë¡œê·¸ì•„ì›ƒ ë™ê¸°í™” í…ŒìŠ¤íŠ¸

```javascript
// 1. ì›¹ì—ì„œ ë¡œê·¸ì¸
window.handleWebLoginSuccess({
  token: 'test_token',
  email: 'test@example.com',
});

// 2. ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬ (Swiftì—ì„œ í˜¸ì¶œ)
window.sendLogoutToWebView();

// 3. ì›¹ë·°ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ í™•ì¸
// - ëª¨ë“  ì €ì¥ì†Œì—ì„œ í† í° ì‚­ì œ
// - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
// - ë¡œê·¸ì¸ ìƒíƒœ falseë¡œ ë³€ê²½

// 4. ì•±ì—ì„œ í† í° ê°±ì‹  ì´ë²¤íŠ¸ ì „ë‹¬ í…ŒìŠ¤íŠ¸
window.sendTokenRefreshToWebView('new_token', 'new_refresh_token');

// 5. ì›¹ë·°ì—ì„œ í† í° ê°±ì‹  ì²˜ë¦¬ í™•ì¸
// - ìƒˆë¡œìš´ í† í°ìœ¼ë¡œ ì—…ë°ì´íŠ¸
// - í† í° ê°±ì‹  íƒ€ì´ë¨¸ ì¬ì„¤ì •
```

## ğŸ“± iOS ì•± ì—°ë™ ê°€ì´ë“œ

### 1. Swiftì—ì„œ ì›¹ë·° ì„¤ì •

```swift
import WebKit

class ViewController: UIViewController, WKScriptMessageHandler {
    var webView: WKWebView!

    override func viewDidLoad() {
        super.viewDidLoad()
        setupWebView()
    }

    func setupWebView() {
        let config = WKWebViewConfiguration()
        let userContentController = WKUserContentController()

        // ì›¹ë·°ì—ì„œ ë°›ì„ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë“±ë¡
        userContentController.add(self, name: "loginHandler")
        userContentController.add(self, name: "logoutHandler")

        config.userContentController = userContentController
        webView = WKWebView(frame: view.bounds, configuration: config)
        view.addSubview(webView)
    }

    // ì›¹ë·°ì—ì„œ ë°›ì€ ë©”ì‹œì§€ ì²˜ë¦¬
    func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
        switch message.name {
        case "loginHandler":
            handleWebLogin(message.body as? [String: Any])
        case "logoutHandler":
            handleWebLogout()
        default:
            break
        }
    }
}
```

### 2. í•˜ì´ë¸Œë¦¬ë“œ ì•±ì—ì„œ melpik ë§í¬ ë¡œë“œ

```swift
import WebKit

class MelpikWebViewController: UIViewController, WKScriptMessageHandler {
    var webView: WKWebView!

    override func viewDidLoad() {
        super.viewDidLoad()
        setupWebView()
        loadMelpikWeb()
    }

    func setupWebView() {
        let config = WKWebViewConfiguration()
        let userContentController = WKUserContentController()

        // ì›¹ë·°ì—ì„œ ë°›ì„ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë“±ë¡
        userContentController.add(self, name: "loginHandler")
        userContentController.add(self, name: "logoutHandler")

        config.userContentController = userContentController
        webView = WKWebView(frame: view.bounds, configuration: config)
        view.addSubview(webView)
    }

    func loadMelpikWeb() {
        // melpik ë§í¬ë¡œ ì›¹ë·° ë¡œë“œ
        if let url = URL(string: "https://your-melpik-domain.com") {
            let request = URLRequest(url: url)
            webView.load(request)
        }
    }

    // ì›¹ë·°ì—ì„œ ë°›ì€ ë©”ì‹œì§€ ì²˜ë¦¬
    func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
        switch message.name {
        case "loginHandler":
            handleWebLogin(message.body as? [String: Any])
        case "logoutHandler":
            handleWebLogout()
        default:
            break
        }
    }

    // ì›¹ì—ì„œ ë°›ì€ ë¡œê·¸ì¸ ì²˜ë¦¬
    func handleWebLogin(_ loginInfo: [String: Any]?) {
        guard let loginInfo = loginInfo else { return }

        // ì•±ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
        if let token = loginInfo["token"] as? String {
            saveTokenToKeychain(token)
        }

        if let refreshToken = loginInfo["refreshToken"] as? String {
            saveRefreshTokenToKeychain(refreshToken)
        }

        print("ì›¹ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ")
    }

    // ì›¹ì—ì„œ ë°›ì€ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
    func handleWebLogout() {
        // ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        clearTokensFromKeychain()
        print("ì›¹ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì„±ê³µ")
    }

    // ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì‹œ ì›¹ë·°ì— ì•Œë¦¼
    func appLogout() {
        // ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        clearTokensFromKeychain()

        // ì›¹ë·°ì— ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬
        sendLogoutToWebView()

        print("ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ")
    }

    // ì•±ì—ì„œ í† í° ê°±ì‹  ì‹œ ì›¹ë·°ì— ì•Œë¦¼
    func appTokenRefresh(newToken: String, newRefreshToken: String) {
        // ì•±ì—ì„œ í† í° ê°±ì‹  ì²˜ë¦¬
        saveTokenToKeychain(newToken)
        saveRefreshTokenToKeychain(newRefreshToken)

        // ì›¹ë·°ì— í† í° ê°±ì‹  ì´ë²¤íŠ¸ ì „ë‹¬
        sendTokenRefreshToWebView(newToken: newToken, newRefreshToken: newRefreshToken)

        print("ì•±ì—ì„œ í† í° ê°±ì‹  ì™„ë£Œ")
    }

    // Keychain ê´€ë ¨ í•¨ìˆ˜ë“¤
    func saveTokenToKeychain(_ token: String) {
        // Keychainì— í† í° ì €ì¥ êµ¬í˜„
    }

    func saveRefreshTokenToKeychain(_ token: String) {
        // Keychainì— refresh í† í° ì €ì¥ êµ¬í˜„
    }

    func clearTokensFromKeychain() {
        // Keychainì—ì„œ í† í° ì‚­ì œ êµ¬í˜„
    }
}
```

### 3. ì•±ì—ì„œ ì›¹ë·°ë¡œ ì´ë²¤íŠ¸ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜ë“¤

```swift
extension MelpikWebViewController {

    // ì•±ì—ì„œ ì›¹ë·°ë¡œ ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬
    func sendLogoutToWebView() {
        let js = """
        if (window.sendLogoutToWebView) {
            window.sendLogoutToWebView();
        } else {
            // ì›¹ë·° í†µì‹  ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ì§ì ‘ ì²˜ë¦¬
            window.dispatchEvent(new CustomEvent('appLogoutRequest', {
                detail: {
                    source: 'native',
                    timestamp: Date.now()
                }
            }));
        }
        """
        webView.evaluateJavaScript(js, completionHandler: nil)
    }

    // ì•±ì—ì„œ ì›¹ë·°ë¡œ í† í° ê°±ì‹  ì´ë²¤íŠ¸ ì „ë‹¬
    func sendTokenRefreshToWebView(newToken: String, newRefreshToken: String) {
        let js = """
        if (window.sendTokenRefreshToWebView) {
            window.sendTokenRefreshToWebView('\(newToken)', '\(newRefreshToken)');
        } else {
            // ì›¹ë·° í†µì‹  ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ì§ì ‘ ì²˜ë¦¬
            window.dispatchEvent(new CustomEvent('appTokenRefresh', {
                detail: {
                    token: '\(newToken)',
                    refreshToken: '\(newRefreshToken)',
                    source: 'native',
                    timestamp: Date.now()
                }
            }));
        }
        """
        webView.evaluateJavaScript(js, completionHandler: nil)
    }

    // ì•±ì—ì„œ ì›¹ë·°ë¡œ ë¡œê·¸ì¸ ì •ë³´ ì „ë‹¬
    func sendLoginToWebView(accessToken: String, refreshToken: String, email: String) {
        let js = """
        window.dispatchEvent(new CustomEvent('loginInfoReceived', {
          detail: {
            isLoggedIn: true,
            userInfo: {
              token: '\(accessToken)',
              refreshToken: '\(refreshToken)',
              email: '\(email)'
            }
          }
        }));
        """
        webView.evaluateJavaScript(js, completionHandler: nil)
    }
}
```

### 4. ì‹¤ì œ ì‚¬ìš© ì˜ˆì œ

```swift
class AppDelegate: UIResponder, UIApplicationDelegate {

    var melpikWebViewController: MelpikWebViewController?

    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {

        // ë©”ì¸ ìœˆë„ìš° ì„¤ì •
        window = UIWindow(frame: UIScreen.main.bounds)

        // Melpik ì›¹ë·° ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
        melpikWebViewController = MelpikWebViewController()

        // ë„¤ë¹„ê²Œì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ê°ì‹¸ê¸°
        let navigationController = UINavigationController(rootViewController: melpikWebViewController!)

        window?.rootViewController = navigationController
        window?.makeKeyAndVisible()

        return true
    }

    // ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì‹œ ì›¹ë·°ì—ë„ ì•Œë¦¼
    func appLogout() {
        // ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        clearTokensFromKeychain()

        // ì›¹ë·°ì— ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ì „ë‹¬
        melpikWebViewController?.sendLogoutToWebView()

        print("ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ")
    }

    // ì•±ì—ì„œ í† í° ê°±ì‹  ì‹œ ì›¹ë·°ì—ë„ ì•Œë¦¼
    func appTokenRefresh(newToken: String, newRefreshToken: String) {
        // ì•±ì—ì„œ í† í° ê°±ì‹  ì²˜ë¦¬
        saveTokenToKeychain(newToken)
        saveRefreshTokenToKeychain(newRefreshToken)

        // ì›¹ë·°ì— í† í° ê°±ì‹  ì´ë²¤íŠ¸ ì „ë‹¬
        melpikWebViewController?.sendTokenRefreshToWebView(newToken: newToken, newRefreshToken: newRefreshToken)

        print("ì•±ì—ì„œ í† í° ê°±ì‹  ì™„ë£Œ")
    }
}
```

```

```
